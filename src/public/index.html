<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Weather App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f9f9f9;
    }
    .data, .chart-container, .sensor-group {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 1rem;
    }
    .sensor-group h2 {
      margin-top: 0;
    }
    .chart-container canvas {
      width: 100%;
      height: 300px;
    }
    button {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      background-color: #28a745;
      color: #fff;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover {
      background-color: #218838;
    }
    /* Стилизуем ссылку как кнопку */
    .home-link {
      display: inline-block;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      background-color: #007bff;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
      transition: background-color 0.3s ease;
      margin-top: 1rem;
    }
    .home-link:hover {
      background-color: #0056b3;
    }
  </style>
  <!-- Подключаем Chart.js через CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Подключаем адаптер времени (moment.js и chartjs-adapter-moment) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
</head>
<body>
  <h1>Добро пожаловать на Weather App</h1>
  <p>При обращении к этому сайту отображаются данные с датчиков, рекомендации и другая информация.</p>
  
  <!-- Основная информация -->
  <div class="data" id="data">
    Загрузка данных...
  </div> 
  <!-- Группа для температур и влажности -->
  <div class="sensor-group" id="tempHumGroup">
    <h2>Температура и влажность</h2>
    <div class="chart-container">
      <canvas id="indoorTempChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="indoorHumChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="outdoorTempChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="outdoorHumChart"></canvas>
    </div>
  </div>
  
  <!-- Группа для газовых датчиков -->
  <div class="sensor-group" id="gasSensorsGroup">
    <h2>Газовые датчики</h2>
    <div class="chart-container">
      <canvas id="mq9Chart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="mq135Chart"></canvas>
    </div>
  </div>
  
  <!-- Раздел с кнопками -->
  <div class="data" id="navigation">
    <button id="setComfortButton">Выставить комфортные значения сейчас</button>
    <!-- Ссылка на отдельную страницу установки комфортных значений -->
    <a href="/comfort" class="home-link">Перейти к настройке комфорта</a>
    <p id="comfortResult"></p>
  </div>
  
  <!-- Подключаем скрипт для графиков -->
  <script src="js/charts.js"></script>
  
  <!-- Скрипт обновления данных с сервера и обработки кнопок -->
  <script>
    function updateData() {
      fetch('/sensors')
        .then(response => response.json())
        .then(data => {
          document.getElementById('data').innerHTML = `
            <p><strong>Температура (внутренняя):</strong> ${data.sensor.temperature}</p>
            <p><strong>Влажность (внутренняя):</strong> ${data.sensor.humidity}</p>
            <p><strong>Температура (наружная):</strong> ${data.outdoor.temperature}</p>
            <p><strong>Влажность (наружная):</strong> ${data.outdoor.humidity}</p>
            <p><strong>Комфорт:</strong> ${data.comfortIndex}</p>
            <p><strong>Рекомендации:</strong> ${data.recommendation}</p>
          `;           
          updateCharts(data);
        })
        .catch(err => {
          console.error('Ошибка получения данных:', err);
          document.getElementById('data').innerHTML = `<p>Ошибка получения данных: ${err}</p>`;
        });
    }
    
    updateData();
    setInterval(updateData, 5000);
    
    document.getElementById('setComfortButton').addEventListener('click', () => {
      fetch('/setComfort', { method: 'POST' })
        .then(response => response.json())
        .then(result => {
          document.getElementById('comfwortResult').textContent = result.message;
        })
        .catch(err => {
          console.error('Ошибка установки комфортных значений:', err);
          document.getElementById('comfortResult').textContent = 'Ошибка установки комфортных значений';
        });
    });
  </script>
</body>
</html>
